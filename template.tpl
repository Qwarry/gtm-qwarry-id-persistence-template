___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Qwarry ID persistence",
  "categories": [
    "SESSION_RECORDING"
  ],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Try to persist a Qwarry ID from url params to localStorage",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const localStorage = require("localStorage");
const getQueryParameters = require("getQueryParameters");
const getTimestampMillis = require("getTimestampMillis");

const QWARRY_ID_URL_QUERY_PARAM_NAME = "qwarryid";
const QWARRY_ID_STORAGE_KEY_NAME = "qwarry_id";
const QWARRY_ID_CREATED_AT_STORAGE_KEY_NAME = "qwarry_id_created_at";

const urlQwarryId = getQueryParameters(QWARRY_ID_URL_QUERY_PARAM_NAME);

if (urlQwarryId) {
  localStorage.setItem(QWARRY_ID_STORAGE_KEY_NAME, urlQwarryId);
  localStorage.setItem(QWARRY_ID_CREATED_AT_STORAGE_KEY_NAME, getTimestampMillis());
}

data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_local_storage",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "qwarry_id"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "qwarry_id_created_at"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Qwarry ID URL param value should exist in the localStorage with key qwarry_id
  code: |-
    mock("getQueryParameters", "123456789");

    runCode();

    const sessionQwarryId = localStorage.getItem("qwarry_id");

    assertThat(sessionQwarryId).isStrictlyEqualTo("123456789");
    assertApi('gtmOnSuccess').wasCalled();
- name: Qwarry ID key should not be present in the localStorage if Qwarry ID URL param
    is absent
  code: |-
    mock("getQueryParameters", "");

    runCode();

    const sessionQwarryId = localStorage.getItem("qwarry_id");

    assertThat(sessionQwarryId).isNull();
    assertApi('gtmOnSuccess').wasCalled();
setup: |-
  const localStorage = require("localStorage");

  localStorage.removeItem("qwarry_id");
  localStorage.removeItem("qwarry_id_created_at");


___NOTES___

Created on 08/09/2020 à 18:44:59


